openapi: 3.1.0
info:
  title: ReferralLoop API
  description: |
    The ReferralLoop API allows you to integrate waitlist and referral functionality into your application.
    
    ## Authentication
    
    All API requests must include your API key in the Authorization header:
    
    ```
    Authorization: Bearer pk_live_YOUR_API_KEY
    ```
    
    ## Rate Limits
    
    Rate limits vary by plan:
    - Starter: 1,000 requests/hour
    - Growth: 10,000 requests/hour
    - Pro: 100,000 requests/hour
    
    Rate limit information is included in response headers:
    - `X-RateLimit-Limit`: Maximum requests allowed
    - `X-RateLimit-Remaining`: Requests remaining
    - `X-RateLimit-Reset`: When the limit resets (ISO 8601)
  version: 1.0.0
  contact:
    name: ReferralLoop Support
    url: https://www.referralloop.dev
  license:
    name: Proprietary

servers:
  - url: https://www.referralloop.dev/api/v1
    description: Production server

tags:
  - name: Waitlists
    description: Manage waitlists
  - name: Signups
    description: Manage signups

paths:
  /waitlists:
    get:
      tags:
        - Waitlists
      summary: List Waitlists
      description: Retrieve all waitlists for your workspace
      operationId: listWaitlists
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successful response
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests allowed
              schema:
                type: integer
            X-RateLimit-Remaining:
              description: Number of requests remaining
              schema:
                type: integer
            X-RateLimit-Reset:
              description: ISO 8601 timestamp when rate limit resets
              schema:
                type: string
                format: date-time
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WaitlistsResponse'
              examples:
                success:
                  value:
                    waitlists:
                      - id: "123e4567-e89b-12d3-a456-426614174000"
                        name: "Product Launch"
                        slug: "product-launch"
                        description: "Join our waitlist"
                        status: "active"
                        created_at: "2024-01-15T10:00:00Z"
                    count: 1
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /waitlists/{waitlistId}/signups:
    get:
      tags:
        - Signups
      summary: List Signups
      description: Retrieve all signups for a specific waitlist
      operationId: listSignups
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/WaitlistId'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Successful response
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests allowed
              schema:
                type: integer
            X-RateLimit-Remaining:
              description: Number of requests remaining
              schema:
                type: integer
            X-RateLimit-Reset:
              description: ISO 8601 timestamp when rate limit resets
              schema:
                type: string
                format: date-time
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignupsListResponse'
              examples:
                success:
                  value:
                    signups:
                      - id: "789e0123-e89b-12d3-a456-426614174000"
                        email: "user@example.com"
                        name: "John Doe"
                        position: 1
                        referral_code: "ABC123"
                        referral_count: 5
                        status: "waiting"
                        created_at: "2024-01-15T10:00:00Z"
                    total: 150
                    limit: 50
                    offset: 0
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Signups
      summary: Create Signup
      description: Add a new signup to a waitlist
      operationId: createSignup
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/WaitlistId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSignupRequest'
            examples:
              basic:
                value:
                  email: "user@example.com"
                  name: "John Doe"
              withMetadata:
                value:
                  email: "user@example.com"
                  name: "John Doe"
                  metadata:
                    source: "landing_page"
                    campaign: "summer_launch"
      responses:
        '201':
          description: Signup created successfully
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests allowed
              schema:
                type: integer
            X-RateLimit-Remaining:
              description: Number of requests remaining
              schema:
                type: integer
            X-RateLimit-Reset:
              description: ISO 8601 timestamp when rate limit resets
              schema:
                type: string
                format: date-time
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignupResponse'
              examples:
                success:
                  value:
                    signup:
                      id: "789e0123-e89b-12d3-a456-426614174000"
                      email: "user@example.com"
                      name: "John Doe"
                      position: 151
                      referral_code: "XYZ789"
                      referral_url: "https://www.referralloop.dev/w/product-launch?ref=XYZ789"
                      created_at: "2024-01-15T10:00:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /waitlists/{waitlistId}/signups/{signupId}:
    get:
      tags:
        - Signups
      summary: Get Signup
      description: Retrieve a specific signup by ID
      operationId: getSignup
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/WaitlistId'
        - $ref: '#/components/parameters/SignupId'
      responses:
        '200':
          description: Successful response
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests allowed
              schema:
                type: integer
            X-RateLimit-Remaining:
              description: Number of requests remaining
              schema:
                type: integer
            X-RateLimit-Reset:
              description: ISO 8601 timestamp when rate limit resets
              schema:
                type: string
                format: date-time
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignupResponse'
              examples:
                success:
                  value:
                    signup:
                      id: "789e0123-e89b-12d3-a456-426614174000"
                      email: "user@example.com"
                      name: "John Doe"
                      position: 1
                      referral_code: "ABC123"
                      referral_url: "https://www.referralloop.dev/w/product-launch?ref=ABC123"
                      referral_count: 5
                      status: "waiting"
                      created_at: "2024-01-15T10:00:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Signups
      summary: Delete Signup
      description: Remove a signup from a waitlist
      operationId: deleteSignup
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/WaitlistId'
        - $ref: '#/components/parameters/SignupId'
      responses:
        '204':
          description: Signup deleted successfully
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests allowed
              schema:
                type: integer
            X-RateLimit-Remaining:
              description: Number of requests remaining
              schema:
                type: integer
            X-RateLimit-Reset:
              description: ISO 8601 timestamp when rate limit resets
              schema:
                type: string
                format: date-time
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Use your API key as the bearer token. API keys can be generated in your dashboard.
        
        Example: `Authorization: Bearer pk_live_YOUR_API_KEY`

  parameters:
    WaitlistId:
      name: waitlistId
      in: path
      required: true
      description: The ID of the waitlist
      schema:
        type: string
        format: uuid
      example: "123e4567-e89b-12d3-a456-426614174000"

    SignupId:
      name: signupId
      in: path
      required: true
      description: The ID of the signup
      schema:
        type: string
        format: uuid
      example: "789e0123-e89b-12d3-a456-426614174000"

    Limit:
      name: limit
      in: query
      description: "Number of results to return (default: 100, max: 1000)"
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 1000
        default: 100
      example: 50

    Offset:
      name: offset
      in: query
      description: "Pagination offset (default: 0)"
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      example: 0

  schemas:
    Waitlist:
      type: object
      required:
        - id
        - name
        - slug
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the waitlist
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          description: Name of the waitlist
          example: "Product Launch"
        slug:
          type: string
          description: URL-friendly identifier for the waitlist
          example: "product-launch"
        description:
          type: string
          nullable: true
          description: Description of the waitlist
          example: "Join our waitlist"
        status:
          type: string
          enum: [active, inactive]
          description: Status of the waitlist
          example: "active"
        created_at:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the waitlist was created
          example: "2024-01-15T10:00:00Z"

    WaitlistsResponse:
      type: object
      required:
        - waitlists
        - count
      properties:
        waitlists:
          type: array
          items:
            $ref: '#/components/schemas/Waitlist'
        count:
          type: integer
          description: Total number of waitlists
          example: 1

    Signup:
      type: object
      required:
        - id
        - email
        - position
        - referral_code
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the signup
          example: "789e0123-e89b-12d3-a456-426614174000"
        email:
          type: string
          format: email
          description: Email address of the signup
          example: "user@example.com"
        name:
          type: string
          nullable: true
          description: Full name of the signup
          example: "John Doe"
        position:
          type: integer
          description: Current position in the waitlist
          example: 1
        referral_code:
          type: string
          description: Unique referral code for this signup
          example: "ABC123"
        referral_url:
          type: string
          format: uri
          nullable: true
          description: Full URL for the referral link
          example: "https://www.referralloop.dev/w/product-launch?ref=ABC123"
        referral_count:
          type: integer
          nullable: true
          description: Number of referrals made by this signup
          example: 5
        status:
          type: string
          enum: [waiting, approved, rejected]
          description: Status of the signup
          example: "waiting"
        created_at:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the signup was created
          example: "2024-01-15T10:00:00Z"
        metadata:
          type: object
          nullable: true
          description: Custom metadata associated with the signup
          additionalProperties: true
          example:
            source: "landing_page"
            campaign: "summer_launch"

    CreateSignupRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          description: Email address of the signup
          example: "user@example.com"
        name:
          type: string
          description: Full name of the signup
          example: "John Doe"
        metadata:
          type: object
          description: Custom data object to store additional information
          additionalProperties: true
          example:
            source: "landing_page"
            campaign: "summer_launch"
        customFields:
          type: object
          description: Custom fields (will be merged into metadata)
          additionalProperties: true

    SignupResponse:
      type: object
      required:
        - signup
      properties:
        signup:
          $ref: '#/components/schemas/Signup'

    SignupsListResponse:
      type: object
      required:
        - signups
        - total
        - limit
        - offset
      properties:
        signups:
          type: array
          items:
            $ref: '#/components/schemas/Signup'
        total:
          type: integer
          description: Total number of signups
          example: 150
        limit:
          type: integer
          description: Number of results returned
          example: 50
        offset:
          type: integer
          description: Pagination offset
          example: 0

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message describing what went wrong
          example: "Invalid API key"
        message:
          type: string
          description: Additional error details
          example: "Upgrade your plan to use the API"
        upgrade_url:
          type: string
          format: uri
          description: URL to upgrade plan (for 403 errors)
          example: "https://www.referralloop.dev/dashboard/billing"
        limit:
          type: integer
          description: Rate limit (for 429 errors)
          example: 1000
        reset_at:
          type: string
          format: date-time
          description: When rate limit resets (for 429 errors)
          example: "2024-01-15T11:00:00Z"
        signup:
          $ref: '#/components/schemas/Signup'
          description: Existing signup information (for 409 errors)

  responses:
    BadRequest:
      description: Bad Request - Invalid parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            invalidEmail:
              value:
                error: "Email is required"
            invalidWaitlist:
              value:
                error: "Waitlist is not active"

    Unauthorized:
      description: Unauthorized - Invalid or missing API key
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            missingKey:
              value:
                error: "Missing or invalid authorization header"
            invalidKey:
              value:
                error: "Invalid API key"

    NotFound:
      description: Not Found - Resource doesn't exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            waitlistNotFound:
              value:
                error: "Waitlist not found"
            signupNotFound:
              value:
                error: "Signup not found"

    Conflict:
      description: Conflict - Resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            duplicateEmail:
              value:
                error: "Email already exists on this waitlist"
                signup:
                  id: "789e0123-e89b-12d3-a456-426614174000"
                  position: 1
                  referral_code: "ABC123"

    RateLimitExceeded:
      description: Too Many Requests - Rate limit exceeded
      headers:
        X-RateLimit-Limit:
          description: Maximum number of requests allowed
          schema:
            type: integer
        X-RateLimit-Remaining:
          description: Number of requests remaining (will be 0)
          schema:
            type: integer
        X-RateLimit-Reset:
          description: ISO 8601 timestamp when rate limit resets
          schema:
            type: string
            format: date-time
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            rateLimit:
              value:
                error: "Rate limit exceeded"
                limit: 1000
                reset_at: "2024-01-15T11:00:00Z"

    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            serverError:
              value:
                error: "Failed to fetch waitlists"

